<html lang="en">
    <head>
    	<meta charset="utf-8">
    	<title>eyecatcher</title>
    	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    	<meta name="description" content="">
    	<meta name="author" content="">
    	<style type="text/css">
        	body {
        		/*padding-top: 60px;*/
        		/*padding-bottom: 40px;*/
                padding: 0;
                margin: 0;
        	}
            .centeredBlock
            {
                background:blue;
                height:50%;
                width:50%;
                position: relative;
                display: inline-block;
                float:left;
            }
            .centeredBlock p,
            #centerText
            {
                display: none;
                color:#fff;
                font-size: 24px;
                padding:20px;
                font-family: Helvetica;
                float: left;
            }
    	</style>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
    </head>

    <body screen_capture_injected="true">

        <div align="center" style="position:absolute;">
        	<canvas id="mainCanvas"></canvas>
        	<video style="display: none;" autoplay></video>
        </div>
        <div class="centeredBlock" id="leftPart">
            <p id="topLeftText">Looking Top Left</p>
        </div>

        <div class="centeredBlock" id="rightPart">
            <p id="topRightText" style="float:right">Looking Top Right</p>
        </div>

        <div class="centeredBlock" id="leftPart">
            <p id="bottomLeftText" style="position:absolute;bottom:20px;left:20px;">Looking Bottom Left</p>
        </div>

        <div class="centeredBlock" id="rightPart">
            <p id="bottomRightText" style="position:absolute;bottom:20px;right:20px;">Looking Bottom Right</p>
        </div>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" ></script>

		<script text="text/javascript" src="build/jsfeat.js"></script>
		<script text="text/javascript" src="build/compatibility.js"></script>
		<script text="text/javascript" src="build/camgaze.js"></script>
		<script text="text/javascript" src="cascades/eye.js"></script>
		<script text="text/javascript" src="cascades/frontalface.js"></script>
        <!-- <script type="text/javascript" src="http://foo123.github.io/examples/common/js/parallel/parallel.min.js"></script> -->
        <!-- <script type="text/javascript" src="http://foo123.github.io/examples/common/js/haar&#45;detector.min.js"></script> -->
        <!-- <script type="text/javascript" src="http://foo123.github.io/examples/common/cascades/haarcascade_frontalface_alt.js"></script> -->
		<script text="text/javascript">
			window.onload = function () {
				var height = 480;
				var width = 640;
                var topLeft     = document.getElementById('topLeftText')
                var topRight    = document.getElementById('topRightText')
                var bottomLeft  = document.getElementById('bottomLeftText')
                var bottomRight = document.getElementById('bottomRightText')
                var centerPart  = document.getElementById('centerText')

				var cGaze = new camgaze.Camgaze(
					width, 
					height, 
					"mainCanvas"
				);
				var eyeTracker      = new camgaze.EyeTracker(width, height);
				var eyeFilter       = new camgaze.EyeFilter();
                var leftGazes       = 0;
                var rightGazes      = 0;
                var centerGazes     = 0;
                var topGazes        = 0;
                var bottomGazes     = 0;
                var gazesToSwitch   = 4;
                var switchTimer     = 500;
                var switchMove;
                var currentHorizontal;
                var currentVertical;
                var switchText = function()
                {
                    topLeft.style.display = "none";
                    topRight.style.display = "none";
                    bottomLeft.style.display = "none";
                    bottomRight.style.display = "none";
                    if(currentHorizontal == 'left' && currentVertical == 'bottom') bottomLeft.style.display = "inline";
                    if(currentHorizontal == 'right' && currentVertical == 'bottom') bottomRight.style.display = "inline";
                    if(currentHorizontal == 'left' && currentVertical == 'top') topLeft.style.display = "inline";
                    if(currentHorizontal == 'right' && currentVertical == 'top') topRight.style.display = "inline";
                }
                var switchImage = function(direction)
                {
                    centerGazes = 0;
                    console.log('====== switching view to '+direction+' ==== ')
                    if(direction == 'left' || direction == 'right')    
                    {
                        currentHorizontal = direction;
                        rightGazes  = 0;
                        leftGazes   = 0;
                    }
                    if(direction == 'bottom'|| direction == 'top')     
                    {
                        currentVertical = direction;
                        topGazes    = 0;
                        bottomGazes = 0;
                    } 
                    switchText();

                }
				var frameOp = function (image_data, video) 
                {
					var trackingData = eyeTracker.track(image_data, video);

					var gazeList = eyeFilter.getFilteredGaze(trackingData);

					if (trackingData.eyeList.length === 2) 
                    {
						gazeList.forEach(
							function (eye) 
                            {
                                if((eye.gazeVector.x < 5) && (eye.gazeVector.y < 5) && (eye.gazeVector.x > -5) && (eye.gazeVector.y > -5))
                                {
                                    centerGazes++;
                                    console.log('==== center gaze ====')
                                    console.log(eye.gazeVector.x, eye.gazeVector.y)
                                    if(centerGazes > gazesToSwitch) 
                                    {
                                        rightGazes  = 0;
                                        leftGazes   = 0;
                                        topGazes    = 0;
                                        bottomGazes = 0;
                                    }
                                }
                                else
                                {
                                    if(eye.gazeVector.x > -10)
                                    {
                                        leftGazes++;
                                        if(leftGazes === gazesToSwitch)switchMove =  setTimeout(switchImage, switchTimer, 'left');
                                    }
                                    else
                                    {
                                        rightGazes++;
                                        if(rightGazes === gazesToSwitch)switchMove =  setTimeout(switchImage, switchTimer, 'right');
                                    };
                                    if(eye.gazeVector.y < -10)
                                    {
                                        topGazes++;
                                        if(topGazes === gazesToSwitch) switchMove = setTimeout(switchImage, switchTimer, 'top');
                                    }
                                    else
                                    {
                                        bottomGazes++;
                                        if(bottomGazes === gazesToSwitch) switchMove = setTimeout(switchImage, switchTimer, 'bottom');
                                    };

                                }
							}
						);
					}
					return image_data;
				};
				cGaze.setFrameOperator(frameOp);
			} 
		</script>
	</body>
</html>

